import { useEffect, useState } from "react";

const API_BASE = import.meta.env.VITE_API_BASE_URL || "http://localhost:3000";

type PdfItem = {
  id: string;
  name: string;
  originalName?: string;
};

export default function PdfList() {
  const [pdfs, setPdfs] = useState<PdfItem[]>([]);
  const [status, setStatus] = useState("");

  const fetchPdfs = async () => {
    try {
      const res = await fetch(`${API_BASE}/pdfs`);
      const data = await res.json();
      if (data.success) {
        setPdfs(data.files);
      } else {
        setStatus("âš ï¸ ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    } catch (err) {
      console.error(err);
      setStatus("âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼");
    }
  };

  const deletePdf = async (filename: string) => {
    if (!confirm(`"${filename}" ã‚’å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) return;
    try {
      const res = await fetch(`${API_BASE}/pdfs/${filename}`, {
        method: "DELETE",
      });
      const data = await res.json();
      if (data.success) {
        setStatus(`ğŸ—‘ï¸ å‰Šé™¤æˆåŠŸ: ${filename}`);
        fetchPdfs(); // å†å–å¾—
      } else {
        setStatus("âŒ å‰Šé™¤å¤±æ•—");
      }
    } catch (err) {
      console.error(err);
      setStatus("âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼");
    }
  };

  useEffect(() => {
    fetchPdfs();
  }, []);

  return (
    <div style={{ marginTop: "2rem" }}>
      <h2>ğŸ“‘ ç™»éŒ²æ¸ˆã¿PDFä¸€è¦§</h2>
      {status && <p>{status}</p>}
      {pdfs.length === 0 ? (
        <p>ğŸ“­ ç™»éŒ²ã•ã‚ŒãŸPDFã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      ) : (
        <ul>
  {pdfs.map((pdf) => (
    <li key={pdf.id} style={{ marginBottom: "0.5rem" }}>
      ğŸ“„ {pdf.originalName || pdf.name}
      <button
        onClick={() => deletePdf(pdf.id)}
        style={{
          marginLeft: "1rem",
          color: "white",
          backgroundColor: "red",
          border: "none",
          padding: "0.2rem 0.5rem",
          borderRadius: "4px",
        }}
      >
        å‰Šé™¤
      </button>
    </li>
  ))}
        </ul>
      )}
    </div>
  );
}

